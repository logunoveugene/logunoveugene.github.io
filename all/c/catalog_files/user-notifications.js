!function(t){var e={};function n(i){if(e[i])return e[i].exports;var o=e[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:i})},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=899)}({15:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(4),o=function(){function t(){var t=this;this._waitingElements=[],this.addWaitingState=function(e){i.Dom_addClasses(e,["ajs-placeholder","ajs-placeholder_waiting"]),t._waitingElements.push(e)}}return Object.defineProperty(t.prototype,"service",{set:function(t){this._service=t},enumerable:!0,configurable:!0}),t.prototype.afterRefresh=function(t){this._waitingElements.forEach(function(t){t.classList.remove("ajs-placeholder_waiting"),setTimeout(function(){t.classList.remove("ajs-placeholder")},1e3)}),this._waitingElements=[]},t}();e.AjaxStateProcessorAbstract=o},171:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){t.MODIFIER_COLOR_BLUE="_blue",t.MODIFIER_COLOR_RED="_red",t.MODIFIER_COLOR_GRAY="_gray",t.MODIFIER_COLOR_GRAY_DARK="_gray_dark",t.MODIFIER_COLOR_WHITE="_white"}(e.LinkColorModifiers||(e.LinkColorModifiers={}))},194:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){t.BOTTOM="_bottom",t.BOTTOM_LEFT="_bottom-left",t.BOTTOM_RIGHT="_bottom-right",t.LEFT="_left",t.RIGHT="_right",t.TOP="_top",t.TOP_LEFT="_top-left",t.TOP_RIGHT="_top-right"}(e.TooltipPositionEnum||(e.TooltipPositionEnum={}))},21:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(7);e.Bem_toggleModifier=function(t,e,n,o){var s=e+"_"+n;i.Dom_toggleClass(t,s,o)}},26:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(21);e.Bem_toggleHiddenModifier=function(t,e,n){i.Bem_toggleModifier(t,e,"hidden",n)}},3:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){t.LOADED="assets:loaded"}(e.AssetsEvents||(e.AssetsEvents={}))},358:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(171),o=function(){function t(){this.BLOCK_CLASS="ui-link",this.MODIFIER_PSEUDOLINK="_pseudolink"}return t.prototype.createLinkBase=function(t,e,n){return this.create(t,e,null,n)},t.prototype.createLinkBlue=function(t,e,n){return this.create(t,e,i.LinkColorModifiers.MODIFIER_COLOR_BLUE,n)},t.prototype.createLinkRed=function(t,e,n){return this.create(t,e,i.LinkColorModifiers.MODIFIER_COLOR_RED,n)},t.prototype.createLinkGray=function(t,e,n){return this.create(t,e,i.LinkColorModifiers.MODIFIER_COLOR_GRAY,n)},t.prototype.createLinkGrayDark=function(t,e,n){return this.create(t,e,i.LinkColorModifiers.MODIFIER_COLOR_GRAY_DARK,n)},t.prototype.createLinkWhite=function(t,e,n){return this.create(t,e,i.LinkColorModifiers.MODIFIER_COLOR_WHITE,n)},t.prototype.create=function(t,e,n,i){void 0===e&&(e=null),void 0===n&&(n=null),void 0===i&&(i=!1);var o=document.createElement("a");return o.classList.add(this.BLOCK_CLASS),null!==e&&(o.href=e),null!==n&&o.classList.add(this.BLOCK_CLASS+n),!1!==i&&o.classList.add(this.BLOCK_CLASS+this.MODIFIER_PSEUDOLINK),"string"==typeof t?o.innerHTML=t:o.appendChild(t),o},t}();e.default=o},4:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Dom_addClasses=function(t,e){e.forEach(function(e){t.classList.add(e)})}},42:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){t.GET="GET",t.POST="POST"}(e.AjaxRequestMethods||(e.AjaxRequestMethods={}))},45:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(3),o=n(6),s=function(){function t(){this.isAsync=!0,this.xhr=new XMLHttpRequest,this.headers={}}return t.prototype.init=function(t,e,n,i){void 0===n&&(n=!0),void 0===i&&(i=!0),this.method=t,this.url=e,this.isAsync=n,this._registerAssets=i,this.headers={"X-Requested-With":"XMLHttpRequest","X-CSRF-Token":o.Dom_getCrsfToken()}},t.prototype.setData=function(t){this.data=t},t.prototype.send=function(t,e){var n=this;if(void 0===t&&(t=function(t){}),void 0===e&&(e=function(t){}),void 0!==this.method&&void 0!==this.url){for(var i in this.xhr.open(this.method,this.url,this.isAsync),this.headers)this.headers.hasOwnProperty(i)&&this.xhr.setRequestHeader(i,this.headers[i]);this.xhr.send(this.data),this.xhr.onreadystatechange=function(){if(XMLHttpRequest.DONE===n.xhr.readyState)if(200===n.xhr.status)n.response=JSON.parse(n.xhr.responseText),t(n.response),n._registerAssets&&n.registerAssets();else{var i={result:!1,errors:["Запрос не был выполнен код ошибки:"+n.xhr.status]};e(i)}$(document).trigger("ajaxComplete")}}else{e({result:!1,errors:["Не была произведена инициализация"]})}},t.prototype.registerAssets=function(){$(document).trigger("ajaxSuccess",[{},{},this.response]),window.dispatchEvent(new CustomEvent(i.AssetsEvents.LOADED))},t}();e.default=s},466:function(t,e,n){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var o=i(n(358)),s=function(){function t(){}return t.prototype.getProfileButtonsBlock=function(t,e){var n=document.createElement("div");n.classList.add("user-notifications__profile-buttons");var i=(new o.default).createLinkBase("Все уведомления",t,!1),s=(new o.default).createLinkBase("Настройка уведомлений",e,!1);return n.appendChild(i),n.appendChild(s),n},t}();e.AbstractUserNotification=s},47:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.stringCountPostfix=function(t,e,n,i){if(void 0===n&&(n=!1),0===t&&void 0!==i)return i;var o=0,s=t%10,r=t%100;2<=s&&s<=4&&(o=1),(0===s||s>=5&&s<=9||r>=11&&r<=19)&&(o=2);var a=e[Math.min(o,e.length)]||"";return n?a:t+" "+a}},6:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Dom_getCrsfToken=function(){return document.querySelector("meta[name=csrf-token]").getAttribute("content")}},7:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Dom_toggleClass=function(t,e,n){void 0===n&&(n=!t.classList.contains(e)),!0===n?t.classList.add(e):t.classList.remove(e)}},899:function(t,e,n){t.exports=n(900)},900:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(901);window.AjaxStateProcessorRegistrator.register("user-notifications",new i.UserNotificationsProcessor)},901:function(t,e,n){"use strict";var i,o=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var s=n(15),r=n(902),a=n(903),c=n(904),u=function(t){function e(){var e=t.call(this)||this;return e.widgets=new Map,e}return o(e,t),e.prototype.build=function(t){var e=document.getElementById(t.id);if(null!==e){var n,i=t.data;switch(i.type){case c.UserNotificationsTypesEnum.TYPE_IN_HEADER:n=new r.UserHeaderNotification;break;case c.UserNotificationsTypesEnum.TYPE_AS_MENU:n=new a.UserMenuNotification}return this.widgets.set(t.id,n),n.init(i,e),e.remove(),{userId:i.userId}}},e.prototype.refresh=function(t){var e=t.data;this.widgets.get(t.id).actualize(e)},e}(s.AjaxStateProcessorAbstract);e.UserNotificationsProcessor=u},902:function(t,e,n){"use strict";var i,o=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var r=n(47),a=n(42),c=s(n(45)),u=n(4),d=n(7),l=n(194),f=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isEventsLoaded=!1,e}return o(e,t),e.prototype.init=function(t,e){this.getEventsUrl=t.getEventsUrl,this.notificationsPageUrl=t.notificationsPageUrl,this.settingsUrl=t.settingsUrl;var n=document.createElement("div");n.classList.add("user-header-notifications");var i=document.createElement("span");u.Dom_addClasses(i,["user-header-notifications__btn","user-header-notifications__btn_inactive"]),i.innerHTML="<i></i>",n.appendChild(i),this.button=i,this.button.addEventListener("click",this.loadEvents.bind(this));var o=document.createElement("div");o.classList.add("user-header-notifications__content"),n.appendChild(o),this.eventsBlock=document.createElement("div"),this.eventsBlock.classList.add("user-header-notifications__events"),o.appendChild(this.eventsBlock),o.appendChild(this.getProfileButtonsBlock(this.notificationsPageUrl,this.settingsUrl)),this.popover=window.popoverBlock.draw(n,o),e.parentElement.insertBefore(n,e)},e.prototype.actualize=function(t){if(t.count>0){var e=document.createElement("span");e.innerText=t.count,e.classList.add("user-header-notifications__btn-count"),this.button.appendChild(e),d.Dom_toggleClass(this.button,"user-header-notifications__btn_inactive",!1),d.Dom_toggleClass(this.button,"user-header-notifications__btn_active",!0)}var n=t.count>0?"Есть "+r.stringCountPostfix(t.count,["уведомление","уведомления","уведомлений"]):"Уведомлений нет";window.tooltip.draw(this.button,n,l.TooltipPositionEnum.BOTTOM),!0===t.isNeedOpen&&this.loadEvents()},e.prototype.loadEvents=function(){var t=this;if(!0!==this.isEventsLoaded){var e=new c.default;e.init(a.AjaxRequestMethods.GET,this.getEventsUrl),e.send(function(e){t.eventsBlock.innerHTML=e.html,t.isEventsLoaded=!0,t.popover.toggle(!0)})}},e}(n(466).AbstractUserNotification);e.UserHeaderNotification=f},903:function(t,e,n){"use strict";var i,o=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var r=n(42),a=s(n(45)),c=n(26),u=n(4),d=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isEventsLoaded=!1,e}return o(e,t),e.prototype.init=function(t,e){var n=this;this.getEventsUrl=t.getEventsUrl,this.notificationsPageUrl=t.notificationsPageUrl,this.settingsUrl=t.settingsUrl;var i=document.createElement("li");i.classList.add("user-menu-notifications");var o=document.createElement("a");u.Dom_addClasses(o,["user-menu-notifications__btn"]),o.innerHTML='<i class="user-menu-notifications__icon-bell"></i><span>Уведомления</span><i class="icon-right"></i>',this.button=o,i.appendChild(o),this.loadEvents.bind(this),this.button.addEventListener("click",function(){c.Bem_toggleHiddenModifier(s,"user-menu-notifications-content",!1),n.loadEvents()});var s=document.createElement("li");s.classList.add("user-menu-notifications-content"),c.Bem_toggleHiddenModifier(s,"user-menu-notifications-content",!0);var r=document.createElement("div");r.innerHTML="<i></i> Уведомления",r.classList.add("user-menu-notifications__return-btn"),s.appendChild(r),r.addEventListener("click",function(){c.Bem_toggleHiddenModifier(s,"user-menu-notifications-content",!0)}),this.eventsBlock=document.createElement("div"),this.eventsBlock.classList.add("user-menu-notifications__events"),s.appendChild(this.eventsBlock),s.appendChild(this.getProfileButtonsBlock(this.notificationsPageUrl,this.settingsUrl)),e.parentElement.insertBefore(i,e),e.parentElement.insertBefore(s,e)},e.prototype.actualize=function(t){if(t.count>0){var e=document.createElement("span");e.classList.add("user-menu-notifications__badge"),e.innerText=t.count,this.button.appendChild(e)}},e.prototype.loadEvents=function(){var t=this;if(!0!==this.isEventsLoaded){var e=new a.default;e.init(r.AjaxRequestMethods.GET,this.getEventsUrl),e.send(function(e){t.eventsBlock.innerHTML=e.html,t.isEventsLoaded=!0})}},e}(n(466).AbstractUserNotification);e.UserMenuNotification=d},904:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t.TYPE_IN_HEADER=0]="TYPE_IN_HEADER",t[t.TYPE_AS_MENU=1]="TYPE_AS_MENU"}(e.UserNotificationsTypesEnum||(e.UserNotificationsTypesEnum={}))}});